name: Reusable Policy Quality

on:
  workflow_call:
    inputs:
      validate_docs:
        required: false
        type: boolean
        default: false

jobs:
  quality:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Validate workflows with actionlint
        uses: rhysd/actionlint@v1.7.11

      - name: Detect policy scope changes
        id: scope
        uses: dorny/paths-filter@v3
        with:
          filters: .github/paths-filter.yml

      - name: Validate reliability docs baseline
        run: |
          test -f docs/reference/reliability-slo.md
          test -f docs/releases/runtime-validation-checklist.md

      - name: Validate docs references
        if: inputs.validate_docs
        run: |
          scripts/generate_docs_reference.sh
          scripts/validate_docs.sh

      - name: Policy scope summary
        run: |
          echo "docs_related=${{ steps.scope.outputs.docs_related }}"
          echo "ci_related=${{ steps.scope.outputs.ci_related }}"
